# MGE via snakemake with added functionality for BGE
- Run using snakemake.sh
- Requires BGE_test_samples.csv (Snakefile and Snakefile2) and gene_fetch_BGE_test_data.csv (Snakefile2)
- Snakemake, TrimGalore, and Exonerate installed in conda env

## Running options:
**Snakefile:**
- Uses config.yaml
  - Contains path to 'BGE_test_samples.csv' ((lists sample names, and fwd and rev read paths) and an output directory)
  - Contains different parameter configurations for -s and -r.
- Uses insecta_cox1.fasta as protein reference (stored in protein_references dir).

**Snakefile2:** 
- Uses config2.yaml
  - Contains a path to 'BGE_test_samples_all.csv', an output directory, and 'gene_fetch_BGE_test_data.csv' (generated by 1_gene_fetch.py. Contains sample names, matched term, protein reference accession number, abs path to .fasta reference sequence, and reference name (i.e. Process ID).
- Uses taxa-specific references from 'gene_fetch_BGE_test_data.csv'. Stored in protein_references_2 dir.

## To do
- Get Snakefile2 working (i.e. so MGE can take a samples_file and protein_references_file containing taxa-specific references as input). Current issue relates to snakemake running samples and protein references 'all against all', as opposed to one sample and one corresponding reference (as listed in 'gene_fetch_BGE_test_data.csv').

See below for suggestions from Marie for fixes:
_Snakemake wants create the full factorial wildcard combinations (the all vs all issue):_
_I think there are different ways to approach this, but one convenient solution might be to add the zip argument in the expand() function which can be used to define how wildcards are combined.
Have a look at the FAQs https://uk01.l.antigena.com/l/7UWdvSuml33y0zzodngXWW0lKy-ZiJosuND7IIfwJZFbzqRlioq~scYbDghNUGlOtPuSEUzpsOhskfaoYAtsxI8P22vfuWAwG7K8IVzZIKyrJFGO3onMM_bfJ6DOUCZmhzZCl0CgfUUZa0IIyra9qE9-SY_Nxtr-n0HZoEEpYAoMU0dUGJyaVm  under "I donâ€™t want expand to use the product of every wildcard, what can I do?" However, I don't know how this behaves if you have also the {gene} wildcard in there..._

_Alternatively, you could use plain python coding to create the combinations you want as suggested here: https://stackoverflow.com/questions/75173778/restricting-wildcard-expansion-to-certain-combinations-in-snakemake. I think, in your case, I would try first the zip argument in the expand() function, but if this does not immediately work, I would directly fall back to python coding because you already added quite a lot of code in order to parse to sample info from the csv files. However, instead of creating 2 dicts, I would create one dict where sample ID is the key and all other information needed are stored in the value, e.g. as tuple or list ["fwd file", "rev file", "ref"]. Then you could access e.g. the reference info like this: dict[sample][2]. Or you do it in separate lists which retain the order of elements as suggested in the stackoverflow thread._
